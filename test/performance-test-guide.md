# 性能测试执行指南

## 🚀 快速开始

### 1. 环境准备

#### 1.1 启动票务系统服务
```bash
# 确保所有微服务都已启动
# 1. 启动Nacos (端口: 8848)
# 2. 启动Redis (端口: 6379)
# 3. 启动MySQL (端口: 3306)
# 4. 启动各个微服务
```

#### 1.2 下载并配置JMeter
```bash
# 下载JMeter 5.5+
# 解压到 D:\apache-jmeter-5.5
# 确保JAVA_HOME环境变量已设置
```

### 2. 执行性能测试

#### 2.1 运行JMeter测试
```bash
# 进入测试目录
cd D:\Tickets\test\jmeter

# 执行测试脚本
run-performance-test.bat
```

#### 2.2 查看测试结果
- 测试结果文件：`test-results/test-results_YYYYMMDD_HHMMSS.jtl`
- HTML报告：`test-results/html-report_YYYYMMDD_HHMMSS/index.html`

### 3. 监控性能数据

#### 3.1 查看实时性能统计
```bash
# 访问性能监控API
curl http://localhost:8080/api/monitor/stats
```

#### 3.2 查看瓶颈分析
```bash
# 获取瓶颈分析结果
curl http://localhost:8080/api/monitor/bottlenecks
```

#### 3.3 生成性能报告
```bash
# 生成完整性能报告
curl http://localhost:8080/api/monitor/report
```

## 📊 测试场景说明

### 场景1：用户注册登录测试
- **并发用户数**: 100
- **持续时间**: 5分钟
- **预期指标**: 响应时间 < 2s, 成功率 > 99%

### 场景2：订单创建测试
- **并发订单**: 50
- **持续时间**: 10分钟
- **预期指标**: 响应时间 < 3s, 成功率 > 95%

### 场景3：支付流程测试
- **并发支付**: 20
- **持续时间**: 10分钟
- **预期指标**: 响应时间 < 5s, 成功率 > 99.5%

## 🔍 结果分析

### 关键指标
1. **响应时间**: 平均响应时间、95%分位数、99%分位数
2. **吞吐量**: TPS (每秒事务数)
3. **成功率**: 请求成功百分比
4. **资源使用**: CPU、内存、线程数

### 瓶颈识别
- 响应时间 > 2秒的方法
- 成功率 < 95%的方法
- 调用频率过高的方法

## 📈 优化建议

### 高优先级优化
1. **订单创建异步化**: 将非核心步骤异步处理
2. **支付流程解耦**: 支付成功后的处理异步化

### 中优先级优化
1. **缓存优化**: 增加Redis缓存命中率
2. **数据库优化**: 优化慢查询

### 低优先级优化
1. **代码优化**: 减少不必要的计算
2. **网络优化**: 优化服务间调用

## 🛠️ 故障排除

### 常见问题
1. **JMeter连接失败**: 检查服务是否启动，端口是否正确
2. **性能数据为空**: 确保已添加@PerformanceMonitor注解
3. **测试结果异常**: 检查系统资源是否充足

### 调试方法
1. 查看应用日志：`logs/ticket-order.log`
2. 查看JMeter日志：`jmeter.log`
3. 使用性能监控API查看实时数据

## 📋 下一步行动

1. **分析测试结果**: 识别性能瓶颈
2. **设计优化方案**: 基于瓶颈设计RocketMQ集成
3. **实施优化**: 按优先级实施优化措施
4. **验证效果**: 重新测试验证优化效果